<!DOCTYPE html>
<html>
<head>
    <title>Lunch Spinner Pro</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; background: #f4f4f9; padding-top: 50px; }
        #canvas-container { position: relative; display: inline-block; }
        #wheelCanvas { border-radius: 50%; border: 8px solid #333; box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        
        /* The Pointer Arrow */
        #pointer {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 0; height: 0; 
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 40px solid #e74c3c;
            z-index: 10;
        }

        .controls { margin-top: 30px; }
        button {
            padding: 15px 40px; font-size: 20px; cursor: pointer;
            background: #2ecc71; color: white; border: none; border-radius: 50px;
            transition: 0.2s; font-weight: bold;
        }
        button:hover { background: #27ae60; transform: scale(1.05); }
        #result { margin-top: 25px; font-size: 28px; font-weight: bold; color: #2c3e50; min-height: 40px; }
    </style>
</head>
<body>

    <h1>üç¥ Lunch Roulette</h1>
    
    <div id="canvas-container">
        <div id="pointer"></div>
        <canvas id="wheelCanvas" width="500" height="500"></canvas>
    </div>

    <div class="controls">
        <button onclick="spin()">SPIN!</button>
        <div id="result"></div>
    </div>

<script>
    const restaurants = ["Mcdonald", "Five Guys", "Yakiniku Like", "Thai", "Ming Ming", "Ramen", "HKT", "Sushi", "Sun King Yuen Curry"];
    const canvas = document.getElementById("wheelCanvas");
    const ctx = canvas.getContext("2d");
    const resultDiv = document.getElementById("result");

    let currentAngle = 0;
    const size = restaurants.length;
    const arc = Math.PI / (size / 2); // Angle per slice

    // 1. Draw the wheel
    function drawWheel() {
        restaurants.forEach((name, i) => {
            const angle = i * arc;
            ctx.fillStyle = `hsl(${i * (360 / size)}, 70%, 60%)`; // Dynamic HSL colors
            
            ctx.beginPath();
            ctx.moveTo(250, 250);
            ctx.arc(250, 250, 250, angle, angle + arc);
            ctx.lineTo(250, 250);
            ctx.fill();

            // 2. Add Text
            ctx.save();
            ctx.translate(250, 250);
            ctx.rotate(angle + arc / 2);
            ctx.textAlign = "right";
            ctx.fillStyle = "white";
            ctx.font = "bold 18px Arial";
            ctx.fillText(name, 230, 10);
            ctx.restore();
        });
    }

    // 2. Spin Logic
    let isSpinning = false;
    function spin() {
        if (isSpinning) return;
        isSpinning = true;
        resultDiv.innerText = "Choosing...";

        const spinRotation = Math.random() * 360 + 1440; // At least 4 full turns
        const duration = 4000;
        const start = performance.now();

        function animate(now) {
            const elapsed = now - start;
            const progress = Math.min(elapsed / duration, 1);
            
            // Ease-out cubic function for smooth stopping
            const easeOut = 1 - Math.pow(1 - progress, 3);
            const currentSpin = easeOut * spinRotation;
            
            canvas.style.transform = `rotate(${currentSpin}deg)`;

            if (progress < 1) {
                requestAnimationFrame(animate);
            } else {
                isSpinning = false;
                calculateWinner(currentSpin);
            }
        }
        requestAnimationFrame(animate);
    }

    function calculateWinner(rotation) {
        // 1. Get the total degrees and normalize to 0-359
        // We subtract the rotation because the wheel moves clockwise 
        // but the array indices technically move counter-clockwise relative to the pointer
        const degrees = rotation % 360;
        
        // 2. Adjust for the North Pointer (90 degrees offset)
        // 3. Divide by (360 / size) to find the index
        const sliceWidth = 360 / size;
        
        // This formula aligns the visual slice under the top pointer to the array index
        let prizeIndex = Math.floor((360 - degrees % 360 + 90) % 360 / sliceWidth);
        
        // Safety check for index bounds
        prizeIndex = prizeIndex % size;

        resultDiv.innerText = "Let's eat at: " + restaurants[prizeIndex];
    }

    drawWheel();
</script>

</body>
</html>